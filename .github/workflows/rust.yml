name: Rust

on:
    push:
        branches: [ master ]
    pull_request:
        branches: [ master ]
    workflow_dispatch:

jobs:
    build:
        runs-on: ubuntu-latest

        steps:
        - name: Checkout repository
          uses: actions/checkout@v4

        - name: Setup node.js
          uses: actions/setup-node@v4

        - name: Install node modules
          working-directory: ./web          
          run: npm ci

        - name: Build web frontend
          working-directory: ./web          
          run: npm run build

        - name: Set up Rust
          uses: actions-rs/toolchain@v1
          with:
            toolchain: stable
            override: true
        - name: Check
          uses: actions-rs/cargo@v1
          with:
            command: check
        - name: Build Binary
          uses: actions-rs/cargo@v1
          with:
            command: build --release
        - name: Archive binary
          uses: actions/upload-artifact@v4
          with:
            name: iptablesweb
            path: target/release/iptablesweb


